var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},Vidyano;(function(n){(function(t){var i=function(){function n(n,t,i){typeof i=="undefined"&&(i=[]);this.index=n;this.name=t;this._templateNames=i;this.templates={};this.autoRenderPageTemplate=!0;this.index.errorTarget.hide();this.index.pageTarget.empty()}return Object.defineProperty(n.prototype,"service",{get:function(){return this.index.service},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoading",{get:function(){return this.index.isLoading},set:function(n){this.index.isLoading=n},enumerable:!0,configurable:!0}),n.prototype.render=function(n){this.index.pageTarget.attr("data-page",this.name);this.autoRenderPageTemplate&&this.templates[this.name]&&n.html(this.templates[this.name].create(this))},n.prototype.load=function(){var t=this,n;return this.autoRenderPageTemplate&&this._templateNames.indexOf(this.name)==-1&&this._templateNames.push(this.name),n=this._templateNames.map(function(n){return t.templates[n]=new r("/Templates/"+n+".html")}).map(function(n){return n._ready}),Promise.all(n)},n}(),u,f,r,e,o;t.Page=i;u=function(n){function t(t,i,r){typeof r=="undefined"&&(r=[]);n.call(this,t,i,r);this.autoRenderPageTemplate=!1}return __extends(t,n),t.prototype.render=function(t){n.prototype.render.call(this,t);t.html(this.content)},t.prototype.load=function(){var t=this;return n.prototype.load.call(this).then(function(){return t.service.getPersistentObject(null,t.index.website+".Page",t.name).then(function(n){return t.content=n.getAttributeValue("Content")})})},t}(i);t.ContentPage=u;f=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.load=function(){var t=this;return n.prototype.load.call(this).then(function(){return t.service.getQuery(t.index.website+"_"+t.name).then(function(n){return t._collection=n})})},Object.defineProperty(t.prototype,"items",{get:function(){return this._collection.items},enumerable:!0,configurable:!0}),t}(i);t.CollectionPage=f;r=function(){function n(t){var r=this,i;this._file=t;this._template=n._cachedTemplates[t];this._ready=this._template?Promise.resolve(!0):new Promise(function(n){$.ajax({url:r._file,dataType:"text",cache:!1,success:function(t){return n(i=t)},error:function(){return n(i="")}})}).then(function(){return n._cachedTemplates[t]=r._template=_.template(i)})}return n.prototype.create=function(n){return this._template(n)},n._cachedTemplates={},n}();t.Template=r;e=function(){function t(n,t,i){typeof n=="undefined"&&(n="https://bootstrap.2sky.be");typeof t=="undefined"&&(t=new o);typeof i=="undefined"&&(i=null);this._serviceUri=n;this._serviceHooks=t;this._website=i;this._isLoading=!1;this.errorTarget=$("#error");this.pageTarget=$("#target")}return Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._isLoading},set:function(n){$("#loading").toggleClass("show",this._isLoading=n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"website",{get:function(){return this._website||this.service.userName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPage",{get:function(){return this._currentPage},enumerable:!0,configurable:!0}),t.prototype.addPage=function(n,t){var i=this;typeof t=="undefined"&&(t="");crossroads.addRoute(t,function(){var t=arguments;i.execute(function(){var r=i._currentPage=new n(i,t);return r.load().then(function(){(r=i._currentPage)&&(r.isLoading=!1,i._currentPage.render(i.pageTarget))})})});crossroads.bypassed.add(function(){console.log("Unabled to find match for route '"+arguments[0]+"'")})},t.prototype.initialize=function(){var n=this;return this.execute(function(){return n.service.initialize().then(function(){return $(document.body).removeClass("initializing")})})},t.prototype.executeError=function(n,t,i){var r=this;if(typeof i=="undefined"&&(i=!0),$("#error").show(),$("#error > .msg").text(n),i){$("#error > .action").show();$("#error > .action").off("click").one("click",function(){$("#error").hide();r.execute(t,i)})}else $("#error > .action").hide()},t.prototype.execute=function(n,t){var i=this;return typeof t=="undefined"&&(t=!0),this.isLoading=!0,n().catch(function(r){i.isLoading=!1;i.executeError(r,n,t)})},t.prototype.start=function(){var t;return this._serviceUri?(this.service=new n.Service(this._serviceUri,this._serviceHooks),this.service.ignoreMobile=!0,this.service.environment="Native",t=this.initialize()):t=Promise.resolve(!0),t.then(function(){var n=function(n){return crossroads.parse(n)};hasher.prependHash="!/";hasher.initialized.add(n);hasher.changed.add(n);hasher.init()})},t}();t.Index=e;o=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.onSessionExpired=function(){document.location.reload()},t}(n.ServiceHooks)})(n.Pages||(n.Pages={}));var t=n.Pages})(Vidyano||(Vidyano={}));
/*
//# sourceMappingURL=vidyano.pages.min.js.map
*/