var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},Vidyano;(function(n){(function(t){var r=function(){function n(n,t){for(var r=[],i=0;i<arguments.length-2;i++)r[i]=arguments[i+2];this.index=n;this.name=t;this._templateNames=r;this.templates={};this.index.errorTarget.hide();this.index.pageTarget.empty()}return Object.defineProperty(n.prototype,"service",{get:function(){return this.index.service},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoading",{get:function(){return this.index.isLoading},set:function(n){this.index.isLoading=n},enumerable:!0,configurable:!0}),n.prototype.render=function(){this.index.pageTarget.attr("data-page",this.name);this.isLoading=!1},n.prototype.load=function(){var n=this,t=this._templateNames.map(function(t){return n.templates[t]=new i("/Templates/"+t+".html")}).map(function(n){return n._ready}),r=this.service.getPersistentObject(null,this.index.website+".Page",this.name).then(function(t){n.content=t.getAttributeValue("Content")});return Promise.all(t.concat([r]))},n}(),u,i,f,e;t.Page=r;u=function(n){function t(t,i){n.call(this,t,i)}return __extends(t,n),t.prototype.render=function(t){n.prototype.render.call(this,t);t.html(this.content)},t}(r);t.ContentPage=u;i=function(){function n(t){var r=this,i;this._file=t;this._template=n._cachedTemplates[t];this._ready=this._template?Promise.resolve(!0):new Promise(function(n){$.ajax({url:r._file,dataType:"text",cache:!1,success:function(t){return n(i=t)},error:function(){return n(i="")}})}).then(function(){return n._cachedTemplates[t]=r._template=_.template(i)})}return n.prototype.create=function(n){return this._template(n)},n._cachedTemplates={},n}();t.Template=i;f=function(){function t(n,t,i){typeof n=="undefined"&&(n="https://bootstrap.2sky.be");typeof t=="undefined"&&(t=new e);typeof i=="undefined"&&(i=null);this._serviceUri=n;this._serviceHooks=t;this._website=i;this._isLoading=!1;this.errorTarget=$("#error");this.pageTarget=$("#target");hasher.prependHash="!/"}return Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._isLoading},set:function(n){$("#loading").toggleClass("show",this._isLoading=n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"website",{get:function(){return this._website||this.service.userName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentPage",{get:function(){return this._currentPage},enumerable:!0,configurable:!0}),t.prototype.addPage=function(n,t){var i=this;typeof t=="undefined"&&(t="");crossroads.addRoute(t,function(){var t=arguments;i.execute(function(){var r=i._currentPage=new n(i,t);return r.load().then(function(){(r=i._currentPage)&&i._currentPage.render(i.pageTarget)})})})},t.prototype.initialize=function(){var n=this;return this.execute(function(){return n.service.initialize().then(function(){return $(document.body).removeClass("initializing")})})},t.prototype.executeError=function(n,t,i){var r=this;if(typeof i=="undefined"&&(i=!0),$("#error").show(),$("#error > .msg").text(n),i){$("#error > .action").show();$("#error > .action").off("click").one("click",function(){$("#error").hide();r.execute(t,i)})}else $("#error > .action").hide()},t.prototype.execute=function(n,t){var i=this;return typeof t=="undefined"&&(t=!0),this.isLoading=!0,n().catch(function(r){i.isLoading=!1;i.executeError(r,n,t)})},t.prototype.start=function(){var t;return this._serviceUri?(this.service=new n.Service(this._serviceUri,this._serviceHooks),this.service.ignoreMobile=!0,this.service.environment="Native",t=this.initialize()):t=Promise.resolve(!0),t.then(function(){var n=function(n){return crossroads.parse(n)};hasher.prependHash="";hasher.initialized.add(n);hasher.changed.add(n);hasher.init()})},t}();t.Index=f;e=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.onSessionExpired=function(){document.location.reload()},t}(n.ServiceHooks)})(n.Pages||(n.Pages={}));var t=n.Pages})(Vidyano||(Vidyano={}));
/*
//# sourceMappingURL=vidyano.pages.min.js.map
*/